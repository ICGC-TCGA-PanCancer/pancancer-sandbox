# Tool to process jsonl metadata generated by [parse_gnos_xml.py](../pcawg_metadata_parser/)

## Overview
Collection of scripts that process the output of pcawg_metadata_parser/parse_gnos_xml.py to generate
reports or data aggregations for various purposes.

### prioritise_by_qc.pl
Currently accepts ``*.jsonl`` or ``*.jsonl.gz`` as input and generates a basic ``*.tsv`` output.

Grouping data by 'GNOS repo' and then ordering by 'Issue Summary' (low->high) will
provide a recommended processing order for the data housed in each repository.

Any records with 'Issue Summary' ``>=65536`` have issues that will prevent use in analysis workflows.  Some of these may be fixable with investigation.

### general fields
* GNOS repo
  * Which GNOS repository holds this donors data
* GNOS study
  * The study that this data is held in
* Unique DonorID
  * Taken directly from ``jsonl`` generated by [parse_gnos_xml.py](../pcawg_metadata_parser/)
* Normalised X
  * Approximate sequence coverage for each T/N pair for this donor.
* Tumours
  * Count of tumours for this donor.
* Issue Summary (last column following the items below)
  * Summarises the issues described below.

### Bit encoded fields
For all of the following a value of ``0`` indicates that this donor does not have an issue of this type.  The bit encoding value is indicated ``[tumour|normal]`` respectively.

* \* available
  * This has 2 non-zero states
    1. not_aligned ``[262144|524288]``
    1. none ``[1048576|2097152]``
* \* low seqX
  * Coverage of sample is <25X (conservative 3gbase denominator)
* \* r1_GC deviation
  * GC fraction of all R1 (regardless of mapping) deviates from 40.9 by > 0.05
* \* r2_GC deviation
  * GC fraction of all R2 (regardless of mapping) deviates from 40.9 by > 0.05
* \* GC dist
  * Difference between GC fraction of R1/R2 is >0.05
* \* isize_sd
  * SD of insert size exceeds 30% of the mean for any readgroup.
* \* edit dist
  * Edit distance from reference in one end is > 2x the rate in the other
* \* dup_frac
  * Duplicate rate >0.15
* \* end map dist
  * Difference in fraction of reads mapped between R1 and R2 >0.25
* \* qc_metric absent
  * Data is mapped by QC stats are absent
* \* broken
  * QC stats present but all 0
